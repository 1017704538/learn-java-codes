<?xml version="1.0" encoding="UTF-8"?>
<!--

       Copyright 2009-2012 the original author or authors.

       Licensed under the Apache License, Version 2.0 (the "License");
       you may not use this file except in compliance with the License.
       You may obtain a copy of the License at

          http://www.apache.org/licenses/LICENSE-2.0

       Unless required by applicable law or agreed to in writing, software
       distributed under the License is distributed on an "AS IS" BASIS,
       WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
       See the License for the specific language governing permissions and
       limitations under the License.

-->

<!DOCTYPE mapper
    PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
    "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.imooc.bean.Message">

  <resultMap type="com.imooc.bean.Message" id="MessageResult">
    <id column="id" jdbcType="INTEGER" property="id"/>
    <result column="command" jdbcType="VARCHAR" property="command"/>
    <result column="description" jdbcType="VARCHAR" property="description"/>
    <result column="content" jdbcType="VARCHAR" property="content"/>
  </resultMap>

<!-- select标签用于书写查询语句-->
  <select id="queryMessageList" parameterType="com.imooc.bean.Message" resultMap="MessageResult">
    select id,command,description,content from message
    <where><!-- 
    		test中书写布尔表达式，如果成功则拼接下边的条件, command是parameterType中的成员变量
    		拼接sql的时候会将‘#{command}’替换成?,取值类似于ognl
    		-->
    	<if test="command != null and !&quot;&quot;.equals(command.trim())">
	    	and command=#{command}
	    </if>
	    <!-- like 查询一般会拼接concat()拼接两个字符串 -->
	    <if test="description != null and ''!=description.trim()">
	    	and description like concat(concat('%',#{description}),'%')
	    </if>
    </where>
  </select>
  
   <select id="queryMessageList2" parameterType="java.util.Map"  resultMap="MessageResult">
    select id,command,description,content from message
    <where><!-- 
    		test中书写布尔表达式，如果成功则拼接下边的条件, command是parameterType中的成员变量
    		拼接sql的时候会将‘#{command}’替换成?,取值类似于ognl
    		-->
    	<if test="command != null and !&quot;&quot;.equals(command.trim())">
	    	and command=#{command}
	    </if>
	    <!-- like 查询一般会拼接concat()拼接两个字符串 -->
	    <if test="description != null and ''!=description.trim()">
	    	and description like concat(concat('%',#{description}),'%')
	    </if>
    </where>
  </select>
  
     <select id="count" parameterType="com.imooc.bean.Message"  resultType="int">
    select count(*) from message
    <where>
    	<if test="command != null and !&quot;&quot;.equals(command.trim())">
	    	and command=#{command}
	    </if>
	    <if test="description != null and ''!=description.trim()">
	    	and description like concat(concat('%',#{description}),'%')
	    </if>
    </where>
  </select>
  
  <!-- 使用sql实现分页查询，不是使用拦截器 
  		oracle分页使用rownum,子查询呢需要使用别名不能使用rownum，row等关键字
  -->
  <select id="queryMessageListByPage" parameterType="java.util.Map" resultMap="MessageResult">
  	select * from ( select rownum r, id,command,description,content from message
  	 	<where>
  			<if test="command != null and command.trim() != ''">
  				and command=#{command}
  			</if>
  			<if test="descriptioin != null and description.trim() != '' ">
  				and descriptioin=#{descriptioin}
  			</if>
  			<if test="page != null">
  			 	and rownum &lt;= #{page.dbNumber}
  			</if>
 		 </where>
  		)
  		<where>
  			 and r &gt; #{page.dbIndex}
 		 </where>
 		 order by id
  </select>
  <select id="queryMessageListByPage2" parameterType="java.util.Map" resultMap="MessageResult">
  	select id,command,description,content from message
    <where><!-- 
    		test中书写布尔表达式，如果成功则拼接下边的条件, command是parameterType中的成员变量
    		拼接sql的时候会将‘#{command}’替换成?,取值类似于ognl
    		-->
    	<if test="command != null and !''.equals(command.trim())">
	    	and command=#{command}
	    </if>
	    <!-- like 查询一般会拼接concat()拼接两个字符串 -->
	    <if test="description != null and ''!=description.trim()">
	    	and description like concat(concat('%',#{description}),'%')
	    </if>
    </where>
  </select>
   <select id="count"  parameterType="com.imooc.bean.Message" resultType="int">
  	select count(*) from message
    <where>
    	<if test="command != null and !&quot;&quot;.equals(command.trim())">
	    	and command=#{command}
	    </if>
	    <if test="description != null and !&quot;&quot;.equals(description.trim())">
	    	and description like concat(concat('%',#{description}),'%')
	    </if>
    </where>
  </select>
  
  
  <!-- 单条数据删除,基本数据类一般使用_parameter取直 -->
  <delete id="deleteOne" parameterType="int">
  	delete from message where id=${_parameter}
  </delete>
  
  <!-- 
  		批量删除数据
  		如果是List,使用 foreach标签遍历出list中的值 collection="list" 一般是固定 的去list的值
  		item接收list中遍历出每一个值，sepatator中的值表示分割符号"," mybatis会自动去除最后一个","
   -->
  <delete id="deleteBatch" parameterType="java.util.List">
  	delete from message where id in( 
  		<foreach collection="list" item="item" separator=",">
  			${item}
  		</foreach>
  	)
  </delete>
  
  <!--更新   -->
  <update id="updateMessage">
  	update message
  	<set>
  		<if test="command != null and !''!=command.trim()">
	    	command=#{command},
	    </if>
	    <if test="description != null and ''!=description.trim()">
	    	description=#{description},
	    </if>
  	</set>
  	<choose>
  		<when test="command != null and !''!=command.trim()">
  			command=#{command},
  		</when>
  		<when test="description != null and ''!=description.trim()">
  			description=#{description},
  		</when>
  		<otherwise>
  			<!-- 其他 -->
  		</otherwise>
  	</choose>
  </update>
  
  <!-- trim标签
  		prefix 前缀
  		suffix 后缀
  		prefixOverrides 去掉前边的内容
  		suffixOverrides 去掉后边的内容
   -->
<!--   <trim prefix="where" suffix="test" prefixOverrides="and|or" suffixOverrides=",">
  	
  </trim>
   -->
</mapper>