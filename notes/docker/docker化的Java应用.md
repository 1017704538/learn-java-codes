# Docker化的Java应用

最近几年Docker是特别的火，可以说有云计算的地方就有Docker，Docker之所以能这么或，确实是解决了大部分企业的痛点。
比如说快速的持续集成，服务的弹性伸缩，部署简单解放运维，还有更重要的是它为企业节省了机器资源，目前已有很多公司
在生产上大规模的使用Docker。Docker已经成为了IT开发人员的必备技能。

本笔记了解：
- 什么是Docker
- 理解Docker
- Docker的简单使用
- Nginx服务
- Docker化的Java Web

## 一、什么是Docker
   
Docker历史
- 2010年dotCloud PASS成立
- 2013年Docker开源
- 2014年6月Docker发布了第一个里程碑版本Docker1.0
- 至今

什么是Docker?  
Docker是一个用来装应用的容器，就像杯子可以装水，笔筒可以放笔，你可以将HelloWorld放在Docker里，可以把网站放在Docker里
可以将你任何想的到的程序放到Docker里。
- Docker is the world’s leading software container platform，Docker是世界领先的容器化平台
- 由Docker公司开发，开源，托管在GitHub
- 跨平台，支持Windows、MacOS、Linux

Docker思想  
![](../images/docker/docker-log.png)  
上图是Docker的Logo，是一条鲸鱼驮着很多的集装箱在大海里自由的翱游，这个Logo非常形象的体现了Docker的思想
- 集装箱  
    在没有集装箱的时候运输货物是非常零散的，货物非常容易掉，有了集装箱之后，货物都装到箱子里边去，箱子是密封的，相对也很
不容易丢失，这容易将货物安全原样的送到目的地。我们可以将货物想象成我们的程序，假如目前你需要将一个运行的程序部署到另外一
台机器上去，很容易出现少考了数据，或配置文件而导致启动不起来，大多是认为的疏忽导致的错误，而Docker的集装箱就是帮我们解决
这样的问题，它这可保证我们的应用程序不管放在哪里都不会缺东西。

- 标准化
  - 运输方式：Docker运输程序有一个超级码头，任何一个地方需要货物的时候，都由鲸鱼先送到超级码头，然后再由鲸鱼从超级码头将
  货物送到目的地。
  - 存储方式：比如你将程序拷贝到笔记本上的时候，你需要指定一个目录，你还得记住这个目录，免得下次你需要改里边的东西，你可
  能还需要往这里传。有了Docker之后，这些我们都不需要了，因为你不需要关心你的应用存在什么地方，你想要运行或停止你的应用程
  序的时候，你只需要执行一个命令就可以了。
  - API:Docker提供了一系列的RestAPI接口，包含了对Docker，也就是对应用的启动、停止、删除、查看等控制，比如说你不用Docker
  的时候，如果你要启动的的Web应用的时候，你需要启动Tomcat的startup命令，停止的时候执行shutdown命令，如果你不使用Tomcat服务
  器，你可能还需要使用别的命令来控制。有了接口标准化，你只需要执行同样的命令就可以控制所有的应用。
  
- 隔离
    隔离以下子可能不太明白，虚拟机知道吧，你要用虚拟机的时候，有自己的可用内存，有硬盘有CPU的存在，完全感觉不到外边主机的存在，
    Docker也差不多，不过在技术上Docker更加轻量，可以实现快速的创建和销毁，比如你创建一个虚拟机可能需要等个几分钟，但是创建Docker
    只需要1s。这种隔离最底层的技术实际上是Linux的一种内核限制机制叫LXC，LXC是一种轻量级的容器虚拟化技术，它最大效率的隔离了进程和
    资源，通过cgroup，namespace等限制隔离进程组和使用的物理资源，比如CPU、内存、IO等等。这种机制早在七八年前加入到Linux内核了
    只是在2013年Docker出世的时候他才火起来。
    
Docker解决了什么问题？  
如果一个应用要正常的运行需要什么？比如一个JavaWeb程序启动起来需要依赖什么？我觉得，需要这么几个部分，首先依赖与最底层的操作系统，
然后操作系统上依赖于JDK、Tomcat、代码、配置文件。操作系统变了可能导致我们的程序运行失败，比如说程序中调用了某些系统命令，换了一
个系统调不起来了。JDK版本也可能导致程序的运行失败，比如说.class文件是用1.7编译的，运行环境装了一个1.6的JDK，就会发现.class识别
不了。Tomcat版本也可能导致程序运行的失败，比如说旧版本的配置在新的版本中不太支持了。代码旧更加有可能了，比如说你的代码引用了一个
C盘或D盘等文件，或者使用了某些系统的环境编码等等。配置也是一样，首先就是可能你少了某些配置文件，要么是你的一些配置是跟系统相关的，
换了一个环境旧运行不起来了。

Docker会将操作系统、JDK、Tomcat、代码、配置一个个的放到集装箱中，再打包放到鲸鱼上，由鲸鱼给我们送到服务器上，在你的机上怎么运行
在服务器上也就怎么运行，不会有任何的问题，也就是说Docker解决了运行环境不一致的问题。

系统好卡，那个哥们又写死循环了？如果大家要跟别人共用服务器的场景，可能会有这样的体会，莫名其妙的发现自己的程序挂了，啥原因，要么是内存
不够了，要么是内存满了。还有就是忽然发现某个服务变慢了，甚至使用终端都比较卡，但是Linux本身就是一个多用户的操作系统，可以给多个用户使用，
怎么办呢？Docker的隔离机制旧解决了这种问题，Docker是怎么解决的呢，如果将大家的程序放到Docker里边运行，就算别人的程序还是四循环，疯狂的
吃CPU，疯狂的打日志把磁盘占满，或者是占用大量的内存，内存泄露，最后都不会导致别人的程序运行错误，只会导致自己的程序运行错误。因为Docker
在启动的时候就给它限定好了最大使用的CPU、内存、硬盘资源等，如果超过了分配的资源就会停止运行。

双十一来了，服务器快撑不住了?大家知道大部分业务量不是每天都是很平均的，特别是电商系统，每年总是会有那么几天业务量要比平时多几倍甚至是几十
倍，比如说双十一，如果按平时的量去准备服务器，大规模访问的时候肯定撑不住，但是每天都按照双十一的情况去准备服务器，那就是极大的浪费，所以就
只能在节日前临时扩展机器，过完节再将多余的机器下线，这就给运维带来了极大的工作量，一到这种节日运维人员需要在每台机器上部署各种各样的服务，
大家知道我要运行一个程序需要装Java、Tomcat等很多东西，并且很有可能启不来，还需要调试。有了Docker之后，一切都变得非常美好了，只需要点击
一下鼠标，就可以从十台服务器变为一百台甚至是更多，这都是分分钟的事，为什么会这么快，这就是Docker标准化的优势，不管在那台机器上，不管要
运行什么服务，都是用标准的方式将我们的程序运过来，下载过来，再用标准的方式将他运行起来，我就可以做到，只要在每台机器上执行一两条命令，就可
以让程序正常跑起来，并且不用担心会不会有问题，总结就是，Docker的标准化让快速扩展弹性伸缩变得简单。
    



